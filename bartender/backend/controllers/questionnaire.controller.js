const Questionnaire = require('../models/questionnaire.model');
const Bartender = require('../models/bartender.model'); // To fetch name and email

const submitQuestionnaire = async (req, res) => {
    try {
        console.log(req.headers);
        console.log("--------------------------------");
        console.log(req.body);
        console.log("--------------------------------");
        const bartenderId = req.userId; // From authentication middleware

        // Fetch bartender's name and email
        const bartender = await Bartender.findByPk(bartenderId);
        if (!bartender) {
            return res.status(404).json({ message: 'Bartender not found.' });
        }

        const {
            dob,
            age,
            gender,
            nationality,
            primaryContact,
            whatsappNumber,
            currentAddress,
            pinCode,
            permanentAddress,
            aadhaar,
            pan,
            passport,
            drivingLicense,
            otherId,
            emergencyContactName,
            emergencyContactRelationship,
            emergencyContactPhone,
            emergencyContactAddress,
            bartendingCourseCompleted,
            courseInstitution,
            courseName,
            courseDuration,
            courseYear,
            courseGrade,
            courseSpecializations,
            responsibleBeverageCertificate,
            responsibleBeverageAuthority,
            responsibleBeverageValidity,
            foodSafetyCertificate,
            foodSafetyAuthority,
            foodSafetyValidity,
            flrCourse,
            flrCompletionDate,
            sommelierCertificate,
            sommelierLevel,
            sommelierBody,
            otherCertifications,
            otherCertificateName,
            otherCertificateAuthority,
            otherCertificateValidity,
            experienceYears,
            experienceMonths,
            experienceLevel,
            jobTitle1,
            company1,
            venueType1,
            otherVenueType1,
            responsibilities1,
            oldFashioned,
            manhattan,
            martini,
            mojito,
            margarita,
            cosmopolitan,
            whiskeySour,
            daiquiri,
            molecularMixology,
            smokedCocktails,
            craftArtisanalCocktails,
            seasonalFreshIngredientCocktails,
            masalaChaiCocktails,
            spicedIndianCocktails,
            regionalFusionDrinks,
            traditionalIndianBeverages,
            flairBartending,
            basicFlair,
            intermediateFlair,
            advancedFlair,
            fireFlair,
            formalFlairTraining,
            competitionParticipation,
            awardsRecognition,
            whiskeyScotchBourbon,
            vodka,
            gin,
            rum,
            tequila,
            brandyCognac,
            liqueurs,
            redWine,
            whiteWine,
            sparklingWineChampagne,
            winePairing,
            lager,
            ale,
            craftBeer,
            internationalBeers,
            professionalKit,
            shakerSet,
            jigger,
            barSpoons,
            muddler,
            strainer,
            fineMeshStrainer,
            channelKnife,
            citrusJuicer,
            bottleOpener,
            corkscrew,
            cuttingBoard,
            paringKnife,
            iceBucket,
            pourSpouts,
            garnishContainers,
            smokingGun,
            molecularMixologyTools,
            immersionBlender,
            centrifuge,
            liquidNitrogen,
            carbonationSystem,
            ownVehicle,
            vehicleType,
            willingToTravel,
            maxTravelDistance,
            marathi,
            hindi,
            english,
            otherLanguage,
            otherLanguageProficiency,
            privateParties,
            weddingReceptions,
            corporateEvents,
            birthdayParties,
            anniversaryCelebrations,
            cocktailParties,
            bachelorParties,
            festivalCelebrations,
            instagram,
            facebook,
            linkedin,
            youtube,
            portfolio,
            legalRightToWork,
            cleanCriminalRecord,
            noPendingCases,
            backgroundVerification,
            alcoholServiceLaws,
            ageVerification,
            responsibleServiceTraining,
            awards,
            mediaCoverage,
            notableEvents
        } = req.body;

        const questionnaireData = {
            fullName: bartender.name,
            email: bartender.email,
            dob,
            age,
            gender,
            nationality,
            primaryContact,
            whatsappNumber,
            currentAddress,
            pinCode,
            permanentAddress,
            aadhaar,
            pan,
            passport,
            drivingLicense,
            otherId,
            emergencyContactName,
            emergencyContactRelationship,
            emergencyContactPhone,
            emergencyContactAddress,
            bartendingCourseCompleted,
            courseInstitution,
            courseName,
            courseDuration,
            courseYear,
            courseGrade,
            courseSpecializations,
            responsibleBeverageCertificate,
            responsibleBeverageAuthority,
            responsibleBeverageValidity,
            foodSafetyCertificate,
            foodSafetyAuthority,
            foodSafetyValidity,
            flrCourse,
            flrCompletionDate,
            sommelierCertificate,
            sommelierLevel,
            sommelierBody,
            otherCertifications,
            otherCertificateName,
            otherCertificateAuthority,
            otherCertificateValidity,
            experienceYears,
            experienceMonths,
            experienceLevel,
            jobTitle1,
            company1,
            venueType1,
            otherVenueType1,
            responsibilities1,
            oldFashioned,
            manhattan,
            martini,
            mojito,
            margarita,
            cosmopolitan,
            whiskeySour,
            daiquiri,
            molecularMixology,
            smokedCocktails,
            craftArtisanalCocktails,
            seasonalFreshIngredientCocktails,
            masalaChaiCocktails,
            spicedIndianCocktails,
            regionalFusionDrinks,
            traditionalIndianBeverages,
            flairBartending,
            basicFlair,
            intermediateFlair,
            advancedFlair,
            fireFlair,
            formalFlairTraining,
            competitionParticipation,
            awardsRecognition,
            whiskeyScotchBourbon,
            vodka,
            gin,
            rum,
            tequila,
            brandyCognac,
            liqueurs,
            redWine,
            whiteWine,
            sparklingWineChampagne,
            winePairing,
            lager,
            ale,
            craftBeer,
            internationalBeers,
            professionalKit,
            shakerSet,
            jigger,
            barSpoons,
            muddler,
            strainer,
            fineMeshStrainer,
            channelKnife,
            citrusJuicer,
            bottleOpener,
            corkscrew,
            cuttingBoard,
            paringKnife,
            iceBucket,
            pourSpouts,
            garnishContainers,
            smokingGun,
            molecularMixologyTools,
            immersionBlender,
            centrifuge,
            liquidNitrogen,
            carbonationSystem,
            ownVehicle,
            vehicleType,
            willingToTravel,
            maxTravelDistance,
            marathi,
            hindi,
            english,
            otherLanguage,
            otherLanguageProficiency,
            privateParties,
            weddingReceptions,
            corporateEvents,
            birthdayParties,
            anniversaryCelebrations,
            cocktailParties,
            bachelorParties,
            festivalCelebrations,
            instagram,
            facebook,
            linkedin,
            youtube,
            portfolio,
            legalRightToWork,
            cleanCriminalRecord,
            noPendingCases,
            backgroundVerification,
            alcoholServiceLaws,
            ageVerification,
            responsibleServiceTraining,
            awards,
            mediaCoverage,
            notableEvents
        };

        // Check if a questionnaire for this email already exists
        const existingQuestionnaire = await Questionnaire.findOne({ where: { email: bartender.email } });
        if (existingQuestionnaire) {
            // Update existing questionnaire
            await existingQuestionnaire.update(questionnaireData);
            return res.status(200).json({ message: 'Questionnaire updated successfully!', questionnaireId: existingQuestionnaire.id });
        }

        // Create new questionnaire
        const questionnaire = await Questionnaire.create(questionnaireData);

        res.status(201).json({ message: 'Questionnaire submitted successfully!', questionnaireId: questionnaire.id });

    } catch (error) {
        console.error('Error submitting questionnaire:', error);
        res.status(500).json({ message: 'Error submitting questionnaire', error: error.message });
    }
};

module.exports = { submitQuestionnaire };
